{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block content %}
<div id="content-main">
    <div class="module" id="changelist-filter">
        <h2 class="module-title">{% translate "NewsGenie Admin Dashboard" %}</h2>
        
        <div class="dashboard-metrics-grid">
            <div class="metric-card">
                <h3><i class="bi bi-journal-text"></i> Total Articles</h3>
                <p class="metric-value">{{ article_stats.total }}</p>
            </div>
            <div class="metric-card approved">
                <h3><i class="bi bi-check-circle-fill"></i> Approved Articles</h3>
                <p class="metric-value">{{ article_stats.approved }}</p>
            </div>
            <div class="metric-card pending">
                <h3><i class="bi bi-hourglass-split"></i> Pending Articles</h3>
                <p class="metric-value">{{ article_stats.pending }}</p>
            </div>
        </div>

        <div class="dashboard-lists-row">
            <div class="dashboard-list-card">
                <h3><i class="bi bi-heart-fill"></i> Top Liked Articles</h3>
                {% if top_liked_articles %}
                <ul>
                    {% for article in top_liked_articles %}
                    <li>
                        <a href="{% url 'admin:news_article_change' article.pk %}">{{ article.title|truncatechars:50 }}</a>
                        <span>{{ article.like_count }} likes</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No liked articles yet.</p>
                {% endif %}
            </div>
            <div class="dashboard-list-card">
                <h3><i class="bi bi-hand-thumbs-up-fill"></i> Top Useful Summaries</h3>
                {% if top_useful_summaries %}
                <ul>
                    {% for article in top_useful_summaries %}
                    <li>
                        <a href="{% url 'admin:news_article_change' article.pk %}">{{ article.title|truncatechars:50 }}</a>
                        <span>{{ article.useful_count }} useful</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No useful feedback yet.</p>
                {% endif %}
            </div>

            <div class="dashboard-list-card">
                <h3><i class="bi bi-chat-dots-fill"></i> Top Commented Articles</h3>
                {% if top_commented_articles %}
                <ul>
                    {% for article in top_commented_articles %}
                    <li>
                        <a href="{% url 'admin:news_article_change' article.pk %}">{{ article.title|truncatechars:50 }}</a>
                        <span>{{ article.comment_count }} comments</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No comments yet.</p>
                {% endif %}
            </div>
             <div class="dashboard-list-card">
                <h3><i class="bi bi-people-fill"></i> Top Readers (Time)</h3>
                {% if top_readers_time %}
                <ul>
                    {% for reader in top_readers_time %}
                    <li>
                        {{ reader.username }} <span>{{ reader.formatted_time }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No reading time data yet.</p>
                {% endif %}
            </div>

            <div class="dashboard-list-card comments-moderation">
                <h3><i class="bi bi-exclamation-triangle-fill"></i> Recent Unapproved Comments</h3>
                {% if recent_unapproved_comments %}
                <ul>
                    {% for comment in recent_unapproved_comments %}
                    <li>
                        <a href="{% url 'admin:news_comment_change' comment.pk %}">"{{ comment.content|truncatechars:40 }}"</a>
                        <p>by {{ comment.user.username }} on {{ comment.article.title|truncatechars:25 }}</p>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>All comments are approved.</p>
                {% endif %}
            </div>
            <div class="dashboard-list-card">
                <h3><i class="bi bi-graph-up-arrow"></i> Top Readers (Scroll)</h3>
                {% if top_readers_scroll %}
                <ul>
                    {% for reader in top_readers_scroll %}
                    <li>
                        {{ reader.username }} <span>{{ reader.avg_scroll_percentage }} avg scroll</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No scroll data yet.</p>
                {% endif %}
            </div>
        </div>

    </div>
    {{ block.super }}
</div>
{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        /* Light Mode Styles (Default) */
        .dashboard-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .metric-card h3 {
            font-size: 1.1rem;
            color: #495057;
            margin-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .metric-card p.metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
        }
        .metric-card.approved p.metric-value { color: #28a745; }
        .metric-card.pending p.metric-value { color: #ffc107; }

        .dashboard-lists-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dashboard-list-card {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        .dashboard-list-card h3 {
            font-size: 1.2rem;
            color: #343a40;
            margin-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .dashboard-list-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        .dashboard-list-card ul li {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f1f1f1;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dashboard-list-card ul li:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .dashboard-list-card ul li a {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }
        .dashboard-list-card ul li a:hover {
            text-decoration: underline;
        }
        .dashboard-list-card ul li span {
            color: #6c757d;
            background-color: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            white-space: nowrap;
            margin-left: 10px;
        }
        .dashboard-list-card p {
            font-size: 0.95rem;
            color: #6c757d;
            margin: auto;
        }
        .comments-moderation a { font-style: italic; }
        .comments-moderation p { font-size: 0.85rem; color: #adb5bd; margin-top: 5px; text-align: left; }
        .comments-moderation li { align-items: flex-start; flex-direction: column; }

        /* FIXED: Dark Mode Theme for Admin Dashboard */
        body.dark-mode .metric-card,
        body.dark-mode .dashboard-list-card {
            background-color: var(--dark-bg-secondary, #2c2c4d);
            border-color: var(--dark-border-color, #3a3a5c);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        body.dark-mode .metric-card h3,
        body.dark-mode .dashboard-list-card h3,
        body.dark-mode .dashboard-list-card ul li {
            color: var(--dark-heading-color, #c0cff0);
        }
        body.dark-mode .dashboard-list-card h3 {
            border-bottom-color: var(--dark-border-color, #3a3a5c);
        }
        body.dark-mode .dashboard-list-card ul li {
            border-bottom-color: var(--dark-border-color, #3a3a5c);
        }
        body.dark-mode .dashboard-list-card ul li span {
            color: var(--dark-heading-color, #c0cff0);
            background-color: var(--dark-bg-primary, #1a1a2e);
        }
        body.dark-mode .dashboard-list-card ul li a {
            color: var(--accent-blue-light, #6dd5ed);
        }
        body.dark-mode .dashboard-list-card p {
            color: var(--dark-text-color, #e0e7e9);
        }
        body.dark-mode .metric-card p.metric-value { color: var(--accent-blue-light, #6dd5ed); }
        body.dark-mode .metric-card.approved p.metric-value { color: var(--accent-success-end, #1dd1a1); }
        body.dark-mode .metric-card.pending p.metric-value { color: #ffc107; } /* Yellow is usually fine on dark */

    </style>
{% endblock %}